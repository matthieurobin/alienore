function showAlert(e,t){$("#modal-helper").removeClass().addClass(t);$("#modal-helper").text(e);$("#modal-helper").show().delay(2500).fadeOut()}function reset(e){$("#form-link").find(":input").each(function(){switch(this.type){case"password":case"select-multiple":case"select-one":case"text":$(this).val("");break;case"textarea":$(this).val("");break;case"checkbox":case"radio":this.checked=false;case"url":$(this).val("");break;case"hidden":$(this).val("");break}})}function editLink(e,t){var n="?c=links&a=data_form&id="+e;$.ajax({type:"GET",url:n,success:function(e){$("#modal-new-link-title").text(t);var n=JSON.parse(e);$("#input-title").val(n.link.title);$("#input-url").val(n.link.url);$("#input-description").val(n.link.description);$("#input-linkid").val(n.link.id);var r=[];for(_i=0;_i<n.tags.length;++_i){$("#tagBox").tagging("add",n.tags[_i].label)}$("#modal-new-link").modal("show")},error:function(){}})}function resetTagBox(){$("#tagBox").tagging("reset");$("#datalist-tags").html("")}function nextPage(){_currentPage+=1;if(_currentPage>_lastLimit){$(".paging").addClass("no-display")}else{switch($(".paging a").data("pagination")){case"default":getLinks();break;case"tag":getLinksByTag(_lastTag);break;case"search":break}}}function getLinks(){$.ajax({type:"GET",url:"?c=links&a=data_all&page="+_currentPage,success:function(e){var t=JSON.parse(e);_lastLimit=t.nbPages;displayLinks(t.links,t.token);$("#nbLinks-count").text(t.nbLinks)},error:function(){}})}function getLinksByTag(e){if(_lastTag!==e||_lastLimit==_currentPage){_currentPage=1;$("#list").html("");$.ajax({type:"GET",url:"?c=tags&a=data_form&tagId="+e,success:function(e){var t=JSON.parse(e);editTag(t);$("#edit-tag").css("opacity","1")},error:function(){}})}_lastTag=e;$(".tags-list-ul li").removeClass("tags-active");$(".paging").removeClass("no-display");$("#tag-"+e).addClass("tags-active");$.ajax({type:"GET",url:"?c=links&a=data_getLinksByTag&tagId="+e,success:function(e){var t=JSON.parse(e);_lastLimit=t.nbPages;displayLinks(t.links,t.token);$("#nbLinks-count").text(t.nbLinks)},error:function(){}})}function editTag(e){$("#input-tag-title").val(e.label);$("#input-tag-id").val(e.id)}function displayLinks(e,t,n,r){if(n===undefined)n=true;if(r===undefined)r=false;var i=e.length;$(".loading").removeClass("no-display");if(_currentPage==1){$("#list").hide()}for(var s=0;s<i;++s){var o=e[s].link;var u=e[s].tags;var a='<div class="link">'+'<div class="link-tools">'+'<button type="button" class="btn btn-warning" onclick="editLink('+o.id+", 'EditLink' )\">"+'<span class="glyphicon glyphicon-pencil"></span>'+"</button> "+'<button type="button" class="btn btn-danger" onclick="location.href = \'?c=links&a=delete&t='+t+"&id="+o.id+"'\">"+'<span class="glyphicon glyphicon-trash"></span>'+"</button>"+"</div>"+'<h4 id="title-'+o.id+'">'+'<a href="'+o.url+'" target="_blank"> '+o.title+" </a>"+"</h4>"+'<p class="link-description-second">'+"<small>"+o.linkdate+"</small> - "+"<a href="+o.url+'" target="_blank">'+o.title+"</a>"+"</p>"+'<p class="link-description">'+o.description+"</p>"+'<div class="tags">';if(u.length>0){for(var f=0;f<u.length;++f){var l=u[f];a+='<div class="tag tag-list">'+'<a class="a-tag pointer" onclick="getLinksByTag('+l.id+')"><span>#</span>'+l.label+"</a></span>"+"</div>"}}a+="</div>"+"</div>";if(!r){if(n){$("#list").append($('<li id="link-'+o.id+'">'+a+"</li>"))}else{$("#list").prepend($('<li id="link-'+o.id+'">'+a+"</li>"))}}else{$("#link-"+o.id).html(a)}}$(".loading").addClass("no-display");if(_currentPage==1){$("#list").slideDown(525)}}function updateTag(e){if(e.new.length>0){for(var t=0;t<e.new.length;++t){var n="#tag-"+e.new[t].id;var r=parseInt($(n+" span.tag-nb-links").eq(0).data("nb-links"));$(n+" span.tag-nb-links").eq(0).text(r+1);$(n+" span.tag-nb-links").eq(0).data("nb-links",r+1)}}if(e.deleted.length>0){for(var t=0;t<e.deleted.length;++t){var n="#tag-"+e.deleted[t].id;var r=parseInt($(n+" span.tag-nb-links").eq(0).data("nb-links"));$(n+" span.tag-nb-links").eq(0).text(r-1);$(n+" span.tag-nb-links").eq(0).data("nb-links",r-1)}}}var tagOptions={"no-duplicate":true,"no-enter":true,"forbidden-chars":[",",".","_","?","<",">","/"]};$("#tagBox").tagging(tagOptions);key("n",function(){$("#a-new-link").click();return false});key("e",function(){$("#a-edit-tag").click();return false});$(":input[class=type-zone]").eq(0).keyup("input",function(){$(":input[class=type-zone]").eq(0).attr("list","datalist-tags");if($(":input[class=type-zone]").eq(0).val().length>=3){var e="?c=tags&a=data_searchTag&search="+$("#tagBox .type-zone").val();$.ajax({type:"GET",url:e,success:function(e){var t=JSON.parse(e);$("#datalist-tags").html("");for(var n=0;n<t.length;++n){$("#datalist-tags").append('<option id="'+t[n].id+'" value="'+t[n].label+'">')}},error:function(){}})}});var _lastTag=undefined;var _currentPage=1;var _lastLimit=1;$("#form-link").on("submit",function(){var e=$(this);$.ajax({url:e.attr("action"),type:e.attr("method"),data:e.serialize(),success:function(e){$("#modal-new-link").modal("hide");var t=JSON.parse(e);console.log(t);var n=t.link;var r=t.tags;if(t.isEdit){var i=n.id;var s={link:n,tags:t.tags.default.concat(t.tags.new)};displayLinks([s],t.token,false,true);updateTag(r)}else{var s={link:n,tags:t.tags.new};displayLinks([s],t.token,false);reset();resetTagBox();var o=parseInt($("#nbLinks-count").text())+1;$("#nbLinks-count").text(o);updateTag(r)}}});return false})