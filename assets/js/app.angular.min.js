angular.module("postModule",[],["$httpProvider",function(a){a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var b=function(a){var d,e,f,g,h,i,j,c="";for(d in a)if(e=a[d],e instanceof Array)for(j=0;j<e.length;++j)h=e[j],f=d+"["+j+"]",i={},i[f]=h,c+=b(i)+"&";else if(e instanceof Object)for(g in e)h=e[g],f=d+"["+g+"]",i={},i[f]=h,c+=b(i)+"&";else void 0!==e&&null!==e&&(c+=encodeURIComponent(d)+"="+encodeURIComponent(e)+"&");return c.length?c.substr(0,c.length-1):c};a.defaults.transformRequest=[function(a){return angular.isObject(a)&&"[object File]"!==String(a)?b(a):a}]}]);var app=angular.module("alienore",["postModule"]);app.factory("httpInterceptor",["$q","$rootScope",function(a,b){var c=0;return{request:function(d){return c++,b.$broadcast("loaderShow"),d||a.when(d)},response:function(d){return 0===--c&&b.$broadcast("loaderHide"),d||a.when(d)},responseError:function(d){return--c||b.$broadcast("loaderHide"),a.reject(d)}}}]),app.config(["$httpProvider",function(a){a.interceptors.push("httpInterceptor")}]),app.filter("unsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),app.controller("mainCtrl",["$scope","$http",function(a,b){a.currentPage=1,a.limit=1,a.search=void 0,a.pagination="default",a.moreLinks=!0,a.tagsSelected=[],a.tags=[],a.links=[],a.nbLinks=0,a.token="",a.formDataLink={},a.formDataTag={},a.formDataSearch={},a.showLoader=!1,a.getLinks=function(){b.get("?c=links&a=data_all").success(function(b){a.links=b.links,a.limit=b.nbPages,a.token=b.token,a.nbLinks=b.nbLinks,a.pagination="default",a.moreLinks=!0})},a.init=function(){a.getLinks(),b.get("?c=tags&a=data_all").success(function(b){a.tags=b.tags})},a.init(),a.newLink=function(){a.formDataLink={},$("#modal-link").modal("show")},a.editLink=function(c){a.formDataLink={},$("#tagBox").tagging("reset"),b.get("?c=links&a=data_get&linkId="+c).success(function(b){for(a.formDataLink=b.link,_i=0;_i<b.tags.length;++_i)$("#tagBox").tagging("add",b.tags[_i].label)}),$("#modal-link").modal("show")},a.submitLink=function(){a.formDataLink.tags=$("#tagBox").tagging("getTags");var c="?c=links&a=data_saved";a.formDataLink.id&&(c+="&linkId="+a.formDataLink.id),b.post(c,a.formDataLink).success(function(b){if(a.formDataLink.id){for(var h=a.links.length,e=0;h>e;++e)if(a.formDataLink.id==a.links[e].link.id){a.links[e].link=b.link,a.links[e].tags=b.tags.added.concat(b.tags.default);break}_nbTags=a.tags.length,_nbTagsAdded=b.tags.added.length;for(var e=0;_nbTags>e;++e)for(var g=0;_nbTagsAdded>g;++g)if(b.tags.added[g].id==a.tags[e].id){a.tags[e].count+=1;break}_nbTagsDeleted=b.tags.deleted.length;for(var e=0;_nbTags>e;++e)for(var g=0;_nbTagsDeleted>g;++g)if(b.tags.deleted[g].id==a.tags[e].id){a.tags[e].count-=1;break}for(var f=b.tags.new.length,e=0;f>e;++e)a.tags.push({count:1,label:b.tags.new[e].label,id:b.tags.new[e].id})}else{for(var c=[],d=b.tags.added.length,e=0;d>e;++e)c.push({label:b.tags.added[e].label,id:b.tags.added[e].id});a.links.splice(0,0,{link:b.link,tags:c}),a.nbLinks+=1;for(var f=b.tags.new.length,e=0;f>e;++e)a.tags.push({count:1,label:b.tags.new[e].label,id:b.tags.new[e].id});_nbTags=a.tags.length,_nbTagsAdded=b.tags.added.length;for(var e=0;_nbTags>e;++e)for(var g=0;_nbTagsAdded>g;++g)if(b.tags.added[g].id==a.tags[e].id){a.tags[e].count+=1;break}}showAlert(b.text,"modal-helper-green"),$("#modal-link").modal("hide")})},a.deleteLink=function(c){b.get("?c=links&a=data_delete&t="+a.token+"&id="+c).success(function(b){$("#link-"+c).fadeOut(400,function(){a.nbLinks-=1,_nbTags=a.tags.length,_nbTagsDeleted=b.tags.deleted.length;for(var c=0;_nbTags>c;++c)for(var d=0;_nbTagsDeleted>d;++d)if(b.tags.deleted[d].id==a.tags[c].id){a.tags[c].count-=1;break}a.$apply(),$(this).remove(),showAlert(b.text,"modal-helper-green")})})},a.editTag=function(c){b.get("?c=tags&a=data_form&tagId="+c).success(function(b){a.formDataTag.label=b.label,a.formDataTag.id=b.id})},a.submitTag=function(){b.post("?c=tags&a=data_saved&tagId="+a.formDataTag.id,a.formDataTag).success(function(b){if(b.saved){_nbTags=a.tags.length;for(var c=0;_nbTags>c;++c)if(a.formDataTag.id==a.tags[c].id){a.tags[c].label=b.tag.label;break}$(".link-tag-"+a.formDataTag.id+" .tag-label ").each(function(){$(this).html(b.tag.label)}),showAlert(b.text,"modal-helper-green")}else showAlert(b.text,"modal-helper-red")}),$("#modal-tag").modal("hide")},a.getLinksByTags=function(c){b.get("?c=links&a=data_getLinksByTags&tagsId="+c.toString()).success(function(b){b.error?showAlert(b.text,"modal-helper-red"):(a.links=b.links,a.limit=b.nbPages,a.pagination="tags",a.moreLinks=!0,a.nbLinks=b.nbLinks)})},a.selectTag=function(c){for(var d=a.tagsSelected.length,e=!1,f=[],g=0;d>g;++g)a.tagsSelected[g].id===c&&(e=!0),f.push(a.tagsSelected[g].id);e||b.get("?c=tags&a=data_get&tagId="+c).success(function(b){3>d&&(a.tagsSelected.push(b),$("#tag-"+c+" .tag-label").addClass("tags-active")),f.push(c),a.getLinksByTags(f)})},a.nextPage=function(){if(a.currentPage+=1,a.currentPage>a.limit)a.moreLinks=!1;else switch(a.pagination){case"default":b.get("?c=links&a=data_all&page="+a.currentPage).success(function(b){a.links=a.links.concat(b.links)});break;case"tags":b.get("?c=links&a=data_getLinksByTag&page="+a.currentPage+"&tagId="+a.tagsSelected).success(function(b){a.links=a.links.concat(b.links)});break;case"search":b.get("?c=links&a=data_search&page="+a.currentPage+"&search="+a.search).success(function(b){a.links=a.links.concat(b.links)})}},a.submitSearch=function(){for(var c=a.tagsSelected.length,d=0;c>d;++d)$("#tag-"+a.tagsSelected[d].id+" .tag-label").removeClass("tags-active");a.tagsSelected=[],a.search=a.formDataSearch.search,$("#input-search").blur(),b.post("?c=links&a=data_search",a.formDataSearch).success(function(b){a.pagination="search",a.links=b.links,a.limit=b.nbPages,a.moreLinks=!0,a.nbLinks=b.nbLinks})},a.removeSearch=function(){a.search=void 0,$("#input-search").val("").blur(),a.getLinks()},a.removeSelectedTag=function(b){if(a.tagsSelected.length>1){for(var c=a.tagsSelected.length,d=[],e=0,f=0;c>f;++f)a.tagsSelected[f].id===b?e=f:d.push(a.tagsSelected[f].id);a.tagsSelected.splice(e,1),a.getLinksByTags(d)}else a.tagsSelected=[],a.getLinks();$("#tag-"+b+" .tag-label").removeClass("tags-active")},a.sortTagsList=function(){a.sort=a.sort?"label"==a.sort?"-count":"label":"label"},a.$on("loaderShow",function(){a.showLoader=!0}),a.$on("loaderHide",function(){a.showLoader=!1})}]),app.controller("installCtrl",["$scope","$http","$window",function(a,b,c){a.formDataInstall={},a.submitInstall=function(){b.post("?c=users&a=data_savedInstall",a.formDataInstall).success(function(a){a.saved?c.location.href=".":showAlert(a.text,"modal-helper-red")})}}]),app.controller("loginCtrl",["$scope","$http","$window",function(a,b,c){a.formDataLogin={},a.submitLogin=function(){b.post("?c=users&a=data_auth",a.formDataLogin).success(function(a){a.error?(reset("#formLogin"),$("#inputToFocus").focus(),showAlert(a.text,"modal-helper-red")):c.location.href="."})}}]),app.controller("preferencesCtrl",["$scope","$http",function(a,b){a.formDataPassword={},a.submitPassword=function(){b.post("?c=account&a=data_savedPassword",a.formDataPassword).success(function(a){a.saved?(reset("#formPassword"),showAlert(a.text,"modal-helper-green")):showAlert(a.text,"modal-helper-red")})}}]),app.controller("usersCtrl",["$scope","$http",function(a,b){a.users=[],a.token="",a.idUserToDelete=null,a.formDataDeleteUser={},a.formDataUser={},a.getUsers=function(){b.get("?c=administration&a=data_getUsers").success(function(b){a.users=b.users,a.token=b.token})},a.getUsers(),a.submitUser=function(){b.post("?c=users&a=data_createUser",a.formDataUser).success(function(b){b.saved?(showAlert(b.text,"modal-helper-green"),a.users.push(b.user)):showAlert(b.text,"modal-helper-red")}),reset("#form-new-user")},a.confirmDelete=function(b){a.idUserToDelete=b},a.deleteUser=function(){$("#modal-delete-user").modal("hide"),a.formDataDeleteUser.idUser=a.idUserToDelete,a.formDataDeleteUser.token=a.token,b.post("?c=administration&a=data_deleteUser",a.formDataDeleteUser).success(function(b){if(b.error)showAlert(b.text,"modal-helper-red");else{showAlert(b.text,"modal-helper-green");for(var c=a.users.length,d=0;c>d;++d)if(a.users[d].id==a.idUserToDelete){a.users.splice(d,1);break}}}),a.formDataDeleteUser={}}}]);